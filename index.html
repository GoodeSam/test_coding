<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åœŸå¦¹é«˜è€ƒè¯æ±‡ 4509</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #f5f4f0;
      --surface: #ffffff;
      --border: #e2ddd6;
      --text-primary: #1a1a1a;
      --text-secondary: #5a554e;
      --text-muted: #9e978e;
      --word-color: #628E39;
      --phonetic-color: #FF9C2D;
      --accent: #628E39;
      --accent-light: #eaf3e1;
      --danger: #c0392b;
      --danger-light: #fdf0ee;
      --radius: 14px;
      --shadow: 0 4px 24px rgba(0,0,0,0.08);
    }

    body {
      font-family: 'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      width: 100%;
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .logo {
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--word-color);
      letter-spacing: 0.02em;
    }
    .logo span { color: var(--text-muted); font-weight: 400; }

    #header-stat {
      font-size: 0.8rem;
      color: var(--text-muted);
      letter-spacing: 0.04em;
    }

    /* â”€â”€ Progress â”€â”€ */
    .progress-wrap {
      width: 100%;
      max-width: 700px;
      padding: 1.5rem 1rem 0;
    }

    .progress-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .progress-bar {
      height: 5px;
      background: var(--border);
      border-radius: 99px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 99px;
      transition: width 0.4s ease;
    }

    /* â”€â”€ Main â”€â”€ */
    main {
      width: 100%;
      max-width: 700px;
      padding: 1.5rem 1rem 3rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.25rem;
    }

    /* â”€â”€ Flash card â”€â”€ */
    .card {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: opacity 0.18s, transform 0.18s;
    }

    .card.flipping { opacity: 0; transform: scale(0.985); }

    /* â”€â”€ Card header (word + phonetic) â”€â”€ */
    .card-head {
      padding: 2.2rem 2.5rem 1.6rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
      position: relative;
    }

    .card-number {
      position: absolute;
      top: 1rem;
      right: 1.25rem;
      font-size: 0.72rem;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }

    .card-word {
      font-size: 3rem;
      font-weight: 800;
      color: var(--word-color);
      letter-spacing: -0.01em;
      line-height: 1;
      font-family: Georgia, 'Times New Roman', serif;
    }

    .card-phonetic {
      font-size: 1.15rem;
      font-style: italic;
      color: var(--phonetic-color);
      letter-spacing: 0.02em;
    }

    /* â”€â”€ Card body (definitions + stats, hidden until revealed) â”€â”€ */
    .card-body {
      padding: 1.5rem 2.5rem 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .card-body.hidden { display: none; }

    .definitions {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .def-line {
      font-size: 1.1rem;
      color: var(--text-primary);
      line-height: 1.5;
    }

    /* â”€â”€ Stats grid â”€â”€ */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 0.5rem;
      border-top: 1px solid var(--border);
      padding-top: 1.1rem;
    }

    .stat-cell {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .stat-label {
      font-size: 0.68rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      line-height: 1.3;
    }

    .stat-value {
      font-size: 0.9rem;
      color: var(--text-secondary);
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .stat-value.in-list-yes { color: var(--word-color); }
    .stat-value.in-list-no  { color: var(--danger); }

    /* â”€â”€ Reveal prompt â”€â”€ */
    .reveal-hint {
      padding: 1.1rem 2.5rem;
      text-align: center;
      font-size: 0.82rem;
      color: var(--text-muted);
      letter-spacing: 0.04em;
      border-top: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.15s;
    }
    .reveal-hint:hover { background: #fafaf8; }
    .reveal-hint.hidden { display: none; }

    /* â”€â”€ Buttons â”€â”€ */
    .btn-row {
      display: flex;
      gap: 0.75rem;
      width: 100%;
    }

    .btn {
      flex: 1;
      padding: 0.85rem 1rem;
      border: none;
      border-radius: var(--radius);
      font-size: 0.92rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
    }

    .btn:active { transform: scale(0.97); }

    .btn-unknown { background: var(--danger-light); color: var(--danger); }
    .btn-unknown:hover { background: #f9dbd8; }

    .btn-known { background: var(--accent-light); color: var(--accent); }
    .btn-known:hover { background: #d8edca; }

    .btn-row.locked .btn { opacity: 0.35; pointer-events: none; }

    /* â”€â”€ Shortcut hint â”€â”€ */
    .shortcut-hint {
      font-size: 0.73rem;
      color: var(--text-muted);
      letter-spacing: 0.04em;
    }

    /* â”€â”€ Mute button â”€â”€ */
    .btn-mute {
      background: none;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.3rem 0.6rem;
      font-size: 1rem;
      cursor: pointer;
      color: var(--text-muted);
      line-height: 1;
      transition: background 0.15s;
    }
    .btn-mute:hover { background: var(--border); }

    kbd {
      display: inline-block;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.1em 0.4em;
      font-size: 0.68rem;
    }

    /* â”€â”€ Summary stats â”€â”€ */
    .summary {
      display: flex;
      gap: 2rem;
    }

    .sum-item { display: flex; flex-direction: column; align-items: center; gap: 0.15rem; }
    .sum-num { font-size: 1.6rem; font-weight: 800; }
    .sum-num.known   { color: var(--accent); }
    .sum-num.unknown { color: var(--danger); }
    .sum-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); }

    /* â”€â”€ Complete screen â”€â”€ */
    .complete-screen {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 3.5rem 2.5rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .complete-icon { font-size: 2.8rem; }
    .complete-title { font-size: 1.8rem; font-weight: 800; color: var(--word-color); }
    .complete-sub { color: var(--text-secondary); font-size: 0.95rem; line-height: 1.6; max-width: 360px; }

    .btn-reset {
      margin-top: 0.5rem;
      padding: 0.8rem 2.2rem;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      font-size: 0.92rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }
    .btn-reset:hover { background: #4e7230; }
    .btn-reset:active { transform: scale(0.97); }

    /* â”€â”€ Word list toggle â”€â”€ */
    .word-list-wrap {
      width: 100%;
      max-width: 700px;
      padding: 0 1rem 2rem;
    }

    .btn-toggle {
      width: 100%;
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.55rem 1rem;
      font-size: 0.78rem;
      color: var(--text-muted);
      cursor: pointer;
      letter-spacing: 0.04em;
      transition: background 0.15s;
    }
    .btn-toggle:hover { background: var(--border); }

    .word-list {
      display: none;
      margin-top: 0.6rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--surface);
      padding: 0.75rem 1rem;
      max-height: 200px;
      overflow-y: auto;
      column-count: 5;
      column-gap: 0.5rem;
    }
    .word-list.open { display: block; }

    .word-chip {
      font-size: 0.75rem;
      padding: 0.1rem 0;
      color: var(--text-muted);
      break-inside: avoid;
    }
    .word-chip.known { color: var(--accent); font-weight: 700; }
  </style>
</head>
<body>

<header>
  <div class="logo">åœŸå¦¹é«˜è€ƒè¯æ±‡<span> Â· 4509è¯</span></div>
  <div id="header-stat"></div>
  <button class="btn-mute" id="btn-mute" title="é™éŸ³ / å–æ¶ˆé™éŸ³">ğŸ”Š</button>
</header>

<div class="progress-wrap">
  <div class="progress-row">
    <span>å­¦ä¹ è¿›åº¦</span>
    <span id="progress-text">0 / 4509</span>
  </div>
  <div class="progress-bar">
    <div class="progress-fill" id="progress-fill" style="width:0%"></div>
  </div>
</div>

<main>
  <!-- Flashcard -->
  <div class="card" id="card">
    <div class="card-head">
      <div class="card-number" id="card-number"></div>
      <div class="card-word"   id="card-word">Loadingâ€¦</div>
      <div class="card-phonetic" id="card-phonetic"></div>
    </div>

    <!-- Reveal hint shown before answer -->
    <div class="reveal-hint" id="reveal-hint">æŒ‰ <kbd>Space</kbd> æˆ–ç‚¹å‡»æŸ¥çœ‹é‡Šä¹‰</div>

    <!-- Definitions + stats, hidden until revealed -->
    <div class="card-body hidden" id="card-body">
      <div class="definitions" id="card-defs"></div>
      <div class="stats-grid">
        <div class="stat-cell">
          <div class="stat-label">ä¸»è¦å½¢å¼</div>
          <div class="stat-value" id="stat-forms" title=""></div>
        </div>
        <div class="stat-cell">
          <div class="stat-label">é«˜è€ƒå‡ºç°æ¬¡æ•°</div>
          <div class="stat-value" id="stat-total"></div>
        </div>
        <div class="stat-cell">
          <div class="stat-label">æ¶‰åŠè¯•å·æ•°</div>
          <div class="stat-value" id="stat-papers"></div>
        </div>
        <div class="stat-cell">
          <div class="stat-label">é«˜è€ƒ3500</div>
          <div class="stat-value" id="stat-inlist"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="btn-row locked" id="btn-row">
    <button class="btn btn-unknown" id="btn-unknown">âœ— &nbsp;è¿˜ä¸ä¼š</button>
    <button class="btn btn-known"   id="btn-known">âœ“ &nbsp;å·²æŒæ¡</button>
  </div>

  <div class="shortcut-hint">
    <kbd>Space</kbd> æŸ¥çœ‹é‡Šä¹‰ &nbsp;Â·&nbsp;
    <kbd>â†</kbd> è¿˜ä¸ä¼š &nbsp;Â·&nbsp;
    <kbd>â†’</kbd> å·²æŒæ¡ &nbsp;Â·&nbsp;
    <kbd>R</kbd> é‡ç½®
  </div>

  <div class="summary">
    <div class="sum-item">
      <div class="sum-num known" id="sum-known">0</div>
      <div class="sum-label">å·²æŒæ¡</div>
    </div>
    <div class="sum-item">
      <div class="sum-num unknown" id="sum-unknown">4509</div>
      <div class="sum-label">å¾…å­¦ä¹ </div>
    </div>
  </div>
</main>

<div class="word-list-wrap">
  <button class="btn-toggle" id="btn-toggle-list">â–¾ &nbsp;å±•å¼€å•è¯åˆ—è¡¨</button>
  <div class="word-list" id="word-list"></div>
</div>

<script type="module">
import { HIGH_FREQUENCY_WORDS } from './src/words.js'
import { VocabularyDeck } from './src/vocabulary.js'

const deck = new VocabularyDeck(HIGH_FREQUENCY_WORDS)

// â”€â”€ DOM refs â”€â”€
const cardEl        = document.getElementById('card')
let   wordEl        = document.getElementById('card-word')
let   phoneticEl    = document.getElementById('card-phonetic')
let   defsEl        = document.getElementById('card-defs')
let   cardNumberEl  = document.getElementById('card-number')
let   cardBodyEl    = document.getElementById('card-body')
let   revealHintEl  = document.getElementById('reveal-hint')
let   statFormsEl   = document.getElementById('stat-forms')
let   statTotalEl   = document.getElementById('stat-total')
let   statPapersEl  = document.getElementById('stat-papers')
let   statInListEl  = document.getElementById('stat-inlist')
const progressFill  = document.getElementById('progress-fill')
const progressText  = document.getElementById('progress-text')
const headerStat    = document.getElementById('header-stat')
const sumKnown      = document.getElementById('sum-known')
const sumUnknown    = document.getElementById('sum-unknown')
const btnKnown      = document.getElementById('btn-known')
const btnUnknown    = document.getElementById('btn-unknown')
const btnRow        = document.getElementById('btn-row')
const wordList      = document.getElementById('word-list')
const btnToggleList = document.getElementById('btn-toggle-list')

const SAVE_KEY = 'vocab-gaokao-known'

// â”€â”€ Audio â”€â”€
const wordIndexMap = new Map(HIGH_FREQUENCY_WORDS.map((w, i) => [w.word, i]))
let currentAudio   = null
let muted          = false

function audioPrefix(idx) {
  return idx < 1000 ? String(idx).padStart(3, '0') : String(idx)
}

function playAudio(src) {
  if (currentAudio) {
    currentAudio.pause()
    currentAudio.src = ''
  }
  if (muted) return
  currentAudio = new Audio(src)
  currentAudio.play().catch(() => {})
}

function playWordAudio(word, type) {
  const idx = wordIndexMap.get(word)
  if (idx === undefined) return
  playAudio(`audio_files/${audioPrefix(idx)}_${type}.wav`)
}

const btnMute = document.getElementById('btn-mute')
btnMute.addEventListener('click', () => {
  muted = !muted
  if (muted && currentAudio) {
    currentAudio.pause()
    currentAudio.src = ''
  }
  btnMute.textContent = muted ? 'ğŸ”‡' : 'ğŸ”Š'
})

// â”€â”€ State â”€â”€
let currentCard = null
let revealed    = false

// â”€â”€ Restore saved progress â”€â”€
const saved = JSON.parse(localStorage.getItem(SAVE_KEY) || '[]')
saved.forEach(w => deck.markKnown(w))

// â”€â”€ Reveal answer â”€â”€
function reveal() {
  if (revealed || !currentCard) return
  revealed = true
  cardBodyEl.classList.remove('hidden')
  revealHintEl.classList.add('hidden')
  btnRow.classList.remove('locked')
  // Play Chinese definition audio
  playWordAudio(currentCard.word, 'cn')
}

// â”€â”€ Show next card â”€â”€
function showCard() {
  if (deck.isComplete()) { showComplete(); return }

  revealed = false
  currentCard = deck.getNextCard()
  const c = currentCard
  const { known, unknown, total, percent } = deck.getProgress()

  cardEl.classList.add('flipping')
  setTimeout(() => {
    // Word + phonetic
    wordEl.textContent     = c.word
    phoneticEl.textContent = c.phonetic
    cardNumberEl.textContent = known + ' / ' + total

    // Definitions
    defsEl.innerHTML = c.definitions.map(d =>
      '<div class="def-line">' + escHtml(d) + '</div>'
    ).join('')

    // Stats
    statFormsEl.textContent = c.forms || 'â€”'
    statFormsEl.title       = c.forms || ''
    statTotalEl.textContent = c.totalCount
    statPapersEl.textContent = c.paperCount + ' å¥—'
    statInListEl.textContent = c.inList ? 'âœ“ æ˜¯' : 'âœ— å¦'
    statInListEl.className   = 'stat-value ' + (c.inList ? 'in-list-yes' : 'in-list-no')

    // Reset reveal state
    cardBodyEl.classList.add('hidden')
    revealHintEl.classList.remove('hidden')
    btnRow.classList.add('locked')

    cardEl.classList.remove('flipping')

    // Play English pronunciation
    playWordAudio(c.word, 'en')
  }, 160)

  // Update progress UI immediately (outside animation)
  progressFill.style.width = percent + '%'
  progressText.textContent = known + ' / ' + total
  headerStat.textContent   = percent + '% å·²æŒæ¡'
  sumKnown.textContent     = known
  sumUnknown.textContent   = unknown

  renderWordList()
}

// â”€â”€ Completion screen â”€â”€
function showComplete() {
  const { total } = deck.getProgress()
  cardEl.innerHTML =
    '<div class="complete-screen">' +
      '<div class="complete-icon">âœ¦</div>' +
      '<div class="complete-title">å…¨éƒ¨ ' + total + ' è¯å·²æŒæ¡ï¼</div>' +
      '<div class="complete-sub">ä½ å·²å®ŒæˆåœŸå¦¹é«˜è€ƒè¯æ±‡ 4509 è¯çš„å…¨éƒ¨å­¦ä¹ ã€‚å¯ä»¥é‡ç½®åé‡æ–°å¤ä¹ ã€‚</div>' +
      '<button class="btn-reset" id="btn-reset-inner">é‡ç½®ï¼Œé‡æ–°å¼€å§‹</button>' +
    '</div>'
  btnRow.style.display = 'none'
  document.getElementById('btn-reset-inner').addEventListener('click', resetDeck)
  progressFill.style.width = '100%'
  progressText.textContent = total + ' / ' + total
  headerStat.textContent   = '100% å·²æŒæ¡'
  sumKnown.textContent     = total
  sumUnknown.textContent   = 0
}

// â”€â”€ Actions â”€â”€
function markKnown() {
  if (!revealed || !currentCard) return
  deck.markKnown(currentCard.word)
  saveProgress()
  showCard()
}

function markUnknown() {
  if (!revealed || !currentCard) return
  deck.markUnknown(currentCard.word)
  showCard()
}

function resetDeck() {
  deck.reset()
  localStorage.removeItem(SAVE_KEY)
  // Rebuild card HTML
  cardEl.innerHTML =
    '<div class="card-head">' +
      '<div class="card-number" id="card-number"></div>' +
      '<div class="card-word"    id="card-word"></div>' +
      '<div class="card-phonetic" id="card-phonetic"></div>' +
    '</div>' +
    '<div class="reveal-hint" id="reveal-hint">æŒ‰ <kbd>Space</kbd> æˆ–ç‚¹å‡»æŸ¥çœ‹é‡Šä¹‰</div>' +
    '<div class="card-body hidden" id="card-body">' +
      '<div class="definitions" id="card-defs"></div>' +
      '<div class="stats-grid">' +
        '<div class="stat-cell"><div class="stat-label">ä¸»è¦å½¢å¼</div><div class="stat-value" id="stat-forms"></div></div>' +
        '<div class="stat-cell"><div class="stat-label">é«˜è€ƒå‡ºç°æ¬¡æ•°</div><div class="stat-value" id="stat-total"></div></div>' +
        '<div class="stat-cell"><div class="stat-label">æ¶‰åŠè¯•å·æ•°</div><div class="stat-value" id="stat-papers"></div></div>' +
        '<div class="stat-cell"><div class="stat-label">é«˜è€ƒ3500</div><div class="stat-value" id="stat-inlist"></div></div>' +
      '</div>' +
    '</div>'

  // Re-bind refs
  wordEl       = document.getElementById('card-word')
  phoneticEl   = document.getElementById('card-phonetic')
  defsEl       = document.getElementById('card-defs')
  cardNumberEl = document.getElementById('card-number')
  cardBodyEl   = document.getElementById('card-body')
  revealHintEl = document.getElementById('reveal-hint')
  statFormsEl  = document.getElementById('stat-forms')
  statTotalEl  = document.getElementById('stat-total')
  statPapersEl = document.getElementById('stat-papers')
  statInListEl = document.getElementById('stat-inlist')

  // Re-attach reveal hint click
  revealHintEl.addEventListener('click', reveal)

  currentCard = null
  revealed    = false
  btnRow.style.display = 'flex'
  btnRow.classList.add('locked')
  showCard()
}

// â”€â”€ Persist â”€â”€
function saveProgress() {
  localStorage.setItem(SAVE_KEY, JSON.stringify([...deck._known]))
}

// â”€â”€ Word list â”€â”€
function renderWordList() {
  if (!wordList.classList.contains('open')) return
  const knownSet = deck._known
  wordList.innerHTML = HIGH_FREQUENCY_WORDS.map(w =>
    '<div class="word-chip ' + (knownSet.has(w.word) ? 'known' : '') + '">' +
      (knownSet.has(w.word) ? 'âœ“ ' : '') + escHtml(w.word) +
    '</div>'
  ).join('')
}

function escHtml(s) {
  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
}

// â”€â”€ Events â”€â”€
revealHintEl.addEventListener('click', reveal)
btnKnown.addEventListener('click', markKnown)
btnUnknown.addEventListener('click', markUnknown)

btnToggleList.addEventListener('click', () => {
  wordList.classList.toggle('open')
  btnToggleList.textContent = wordList.classList.contains('open')
    ? 'â–´ \u00a0æ”¶èµ·å•è¯åˆ—è¡¨'
    : 'â–¾ \u00a0å±•å¼€å•è¯åˆ—è¡¨'
  renderWordList()
})

document.addEventListener('keydown', e => {
  if (e.key === ' ' || e.key === 'Spacebar') { e.preventDefault(); reveal() }
  if (e.key === 'ArrowRight') markKnown()
  if (e.key === 'ArrowLeft')  markUnknown()
  if (e.key === 'r' || e.key === 'R') resetDeck()
})

// â”€â”€ Boot â”€â”€
showCard()
</script>
</body>
</html>
